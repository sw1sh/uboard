(function(){function e(e){var t=document.createElement("div");e="on"+e;var n=e in t;return n||(t.setAttribute(e,"return;"),n=typeof t[e]=="function"),t=null,n}function t(e){return Object.isElement(e)&&e.nodeName.toUpperCase()=="FORM"}function n(e){if(Object.isElement(e)){var t=e.nodeName.toUpperCase();return t=="INPUT"||t=="SELECT"||t=="TEXTAREA"}return!1}function s(e){var t,n,r,i=e.fire("ajax:before");if(i.stopped)return!1;e.tagName.toLowerCase()==="form"?(t=e.readAttribute("method")||"post",n=e.readAttribute("action"),r=e.serialize({submit:e.retrieve("rails:submit-button")}),e.store("rails:submit-button",null)):(t=e.readAttribute("data-method")||"get",n=e.readAttribute("href"),r={}),new Ajax.Request(n,{method:t,parameters:r,evalScripts:!0,onCreate:function(t){e.fire("ajax:create",t)},onComplete:function(t){e.fire("ajax:complete",t)},onSuccess:function(t){e.fire("ajax:success",t)},onFailure:function(t){e.fire("ajax:failure",t)}}),e.fire("ajax:after")}function o(e,t,n){e.insert(new Element("input",{type:"hidden",name:t,value:n}))}function u(e){var t=e.readAttribute("data-method"),n=e.readAttribute("href"),r=$$("meta[name=csrf-param]")[0],i=$$("meta[name=csrf-token]")[0],s=new Element("form",{method:"POST",action:n,style:"display: none;"});$(e.parentNode).insert(s),t!=="post"&&o(s,"_method",t),r&&o(s,r.readAttribute("content"),i.readAttribute("content")),s.submit()}function a(e){e.select("input[type=submit][data-disable-with]").each(function(e){e.store("rails:original-value",e.getValue()),e.setValue(e.readAttribute("data-disable-with")).disable()})}function f(e){e.select("input[type=submit][data-disable-with]").each(function(e){e.setValue(e.retrieve("rails:original-value")).enable()})}function l(e){var t=e.readAttribute("data-confirm");return!t||confirm(t)}var r=e("submit"),i=e("change");if(!r||!i)Event.Handler.prototype.initialize=Event.Handler.prototype.initialize.wrap(function(e,s,o,u,a){e(s,o,u,a);if(!r&&this.eventName=="submit"&&!t(this.element)||!i&&this.eventName=="change"&&!n(this.element))this.eventName="emulated:"+this.eventName});r||document.on("focusin","form",function(e,t){t.retrieve("emulated:submit")||(t.on("submit",function(e){var n=t.fire("emulated:submit",e,!0);n.returnValue===!1&&e.preventDefault()}),t.store("emulated:submit",!0))}),i||document.on("focusin","input, select, textarea",function(e,t){t.retrieve("emulated:change")||(t.on("change",function(e){t.fire("emulated:change",e,!0)}),t.store("emulated:change",!0))}),document.on("click","a[data-confirm], a[data-remote], a[data-method]",function(e,t){if(!l(t))return e.stop(),!1;t.readAttribute("data-remote")?(s(t),e.stop()):t.readAttribute("data-method")&&(u(t),e.stop())}),document.on("click","form input[type=submit], form button[type=submit], form button:not([type])",function(e,t){e.findElement("form").store("rails:submit-button",t.name||!1)}),document.on("submit",function(e){var t=e.findElement();if(!l(t))return e.stop(),!1;t.readAttribute("data-remote")?(s(t),e.stop()):a(t)}),document.on("ajax:create","form",function(e,t){t==e.findElement()&&a(t)}),document.on("ajax:complete","form",function(e,t){t==e.findElement()&&f(t)}),Ajax.Responders.register({onCreate:function(e){var t=$$("meta[name=csrf-token]")[0];if(t){var n="X-CSRF-Token",r=t.readAttribute("content");e.options.requestHeaders||(e.options.requestHeaders={}),e.options.requestHeaders[n]=r}}})})();