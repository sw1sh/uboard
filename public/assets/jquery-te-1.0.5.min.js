/*!
 * http://jqueryte.com
 * jQuery TE 1.0.5
 * Copyright (C) 2012, Fatih Koca (fatihkoca@me.com), AUTHOR.txt (http://jqueryte.com/about)
 * This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
You should have received a copy of the GNU General Public License along with this library; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 *
*/
(function(e){e.fn.jqte=function(t){var n=e.extend({css:"jqte",b:!0,i:!0,u:!0,ol:!0,ul:!0,sub:!0,sup:!0,outdent:!0,indent:!0,strike:!0,remove:!0,rule:!0},t),r=e.extend({b:{cls:"bold",command:"Bold",key:"B",tags:["b","strong"]},i:{cls:"italic",command:"Italic",key:"I",tags:["i","em"]},u:{cls:"underline",command:"Underline",key:"U",tags:["u"]},ol:{cls:"orderedlist",command:"insertorderedlist",key:"¾",tags:["ol"]},ul:{cls:"unorderedlist",command:"insertunorderedlist",key:"¼",tags:["ul"]},sub:{cls:"subscript",command:"subscript",key:"(",tags:["sub"]},sup:{cls:"superscript",command:"superscript",key:"&",tags:["sup"]},outdent:{cls:"outdent",command:"outdent",key:"%",tags:["sup"]},indent:{cls:"indent",command:"indent",key:"'",tags:["sup"]},strike:{cls:"strike",command:"strikeThrough",key:"K",tags:["strike"]},remove:{cls:"remove",command:"removeformat",key:".",css:!1},hr:{cls:"rule",command:"inserthorizontalrule",key:"H",tags:["hr"]}},t);return this.each(function(){function t(e){var t,n,r=navigator.userAgent.toLowerCase();window.getSelection?(n=window.getSelection(),n.getRangeAt&&(t=n.getRangeAt(0)),t&&(n.removeAllRanges(),n.addRange(t)),r.match(/msie/)||document.execCommand("StyleWithCSS",!1,!1),document.execCommand(e,!1,null)):document.selection&&document.selection.createRange&&document.selection.type!="None"&&(t=document.selection.createRange(),t.execCommand(e,!1,null))}function i(t,n){var r=!1,i=v(),s,o;return e.each(t,function(t,n){s=i.prop("tagName").toLowerCase(),o=i.attr("style"),s==n?r=!0:i.parents().each(function(){s=e(this).prop("tagName").toLowerCase(),s==n&&(r=!0)})}),r}function s(t){n.b&&(i(r.b.tags,r.b.css)?l.find("."+r.b.cls).addClass(p):e("."+r.b.cls).removeClass(p)),n.i&&(i(r.i.tags,r.i.css)?l.find("."+r.i.cls).addClass(p):e("."+r.i.cls).removeClass(p)),n.u&&(i(r.u.tags,r.u.css)?l.find("."+r.u.cls).addClass(p):e("."+r.u.cls).removeClass(p)),n.ol&&(i(r.ol.tags,r.ol.css)?l.find("."+r.ol.cls).addClass(p):e("."+r.ol.cls).removeClass(p)),n.ul&&(i(r.ul.tags,r.ul.css)?l.find("."+r.ul.cls).addClass(p):e("."+r.ul.cls).removeClass(p)),n.sub&&(i(r.sub.tags,r.sub.css)?l.find("."+r.sub.cls).addClass(p):e("."+r.sub.cls).removeClass(p)),n.sup&&(i(r.sup.tags,r.sup.css)?l.find("."+r.sup.cls).addClass(p):e("."+r.sup.cls).removeClass(p)),n.strike&&(i(r.strike.tags,r.strike.css)?l.find("."+r.strike.cls).addClass(p):e("."+r.strike.cls).removeClass(p))}function o(){var e=h.html().replace(/<p><\/p>/g,"").replace(/ /g," ").replace(/<p> <\/p>/g,""),t,n;t=[/\<div>(.*?)\<\/div>/ig,/\<br>(.*?)\<br>/ig,/\<br\/>(.*?)\<br\/>/ig,/\<strong>(.*?)\<\/strong>/ig,/\<em>(.*?)\<\/em>/ig],n=["<p>$1</p>","<p>$1</p>","<p>$1</p>","<b>$1</b>","<i>$1</i>"];for(var r=0;r<t.length;r++)e=e.replace(t[r],n[r]);u.val(h.html())}var u=e(this);u.hide().before('<div class="'+n.css+'" ></div>');var f=u.prev("."+n.css);f.html('<div class="'+n.css+"_Panel"+'" unselectable="on"></div> <div class="'+n.css+"_Content"+'" contenteditable="true"></div>');var l=f.find("."+n.css+"_Panel"),h=f.find("."+n.css+"_Content"),p=n.css+"_Active";h.html(u.val()),l.bind("selectstart mousedown",function(e){e.preventDefault()}),n.b&&l.append('<a class="'+r.b.cls+'" toggletag="'+r.b.command+'" unselectable="on"></a>'),n.i&&l.append('<a class="'+r.i.cls+'" toggletag="'+r.i.command+'" unselectable="on"></a>'),n.u&&l.append('<a class="'+r.u.cls+'" toggletag="'+r.u.command+'" unselectable="on"></a>'),n.ol&&l.append('<a class="'+r.ol.cls+'" toggletag="'+r.ol.command+'" unselectable="on"></a>'),n.ul&&l.append('<a class="'+r.ul.cls+'" toggletag="'+r.ul.command+'" unselectable="on"></a>'),n.sub&&l.append('<a class="'+r.sub.cls+'" toggletag="'+r.sub.command+'" unselectable="on"></a>'),n.sup&&l.append('<a class="'+r.sup.cls+'" toggletag="'+r.sup.command+'" unselectable="on"></a>'),n.outdent&&l.append('<a class="'+r.outdent.cls+'" toggletag="'+r.outdent.command+'" unselectable="on"></a>'),n.indent&&l.append('<a class="'+r.indent.cls+'" toggletag="'+r.indent.command+'" unselectable="on"></a>'),n.strike&&l.append('<a class="'+r.strike.cls+'" toggletag="'+r.strike.command+'" unselectable="on"></a>'),n.remove&&l.append('<a class="'+r.remove.cls+'" toggletag="'+r.remove.command+'" unselectable="on"></a>'),n.rule&&l.append('<a class="'+r.hr.cls+'" toggletag="'+r.hr.command+'" unselectable="on"></a>'),h.focusout(function(){l.find("a").removeClass(p)});var v=function(){var t,n;window.getSelection&&(n=getSelection(),t=n.anchorNode);if(!t&&document.selection){n=document.selection;var r=n.getRangeAt?n.getRangeAt(0):n.createRange();t=r.commonAncestorContainer?r.commonAncestorContainer:r.parentElement?r.parentElement():r.item(0)}if(t)return t.nodeName=="#text"?e(t.parentNode):e(t)};l.find("a").click(function(){h.not(":focus")&&h.focus(),t(e(this).attr("toggletag")),o(),e(this).hasClass(p)||e(this).is("[toggletag="+r.remove.command+"]")||e(this).is("[toggletag="+r.hr.command+"]")||e(this).is("[toggletag="+r.indent.command+"]")||e(this).is("[toggletag="+r.outdent.command+"]")?e(this).removeClass(p):e(this).addClass(p)}),e.ctrl=function(e,t,n){h.keydown(function(r){n||(n=[]);if(r.keyCode==e.charCodeAt(0)&&r.ctrlKey)return t.apply(this,n),!1})},e.ctrl(r.b.key,function(){t(r.b.command)}),e.ctrl(r.i.key,function(){t(r.i.command)}),e.ctrl(r.u.key,function(){t(r.u.command)}),e.ctrl(r.ol.key,function(){t(r.ol.command)}),e.ctrl(r.ul.key,function(){t(r.ul.command)}),e.ctrl(r.sub.key,function(){t(r.sub.command)}),e.ctrl(r.sup.key,function(){t(r.sup.command)}),e.ctrl(r.indent.key,function(){t(r.indent.command)}),e.ctrl(r.outdent.key,function(){t(r.outdent.command)}),e.ctrl(r.strike.key,function(){t(r.strike.command)}),e.ctrl(r.remove.key,function(){t(r.remove.command)}),e.ctrl(r.hr.key,function(){t(r.hr.command)}),h.bind("mouseup keyup",s).bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){e(this).trigger("change")}).bind("change",function(){setTimeout(o,0)})})}})(jQuery);